<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Variable selection • vimix</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Variable selection">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-128138627-5"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-128138627-5');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">vimix</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9004</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/index.html">
    <span class="fa fa-play-circle"></span>
     
    Vignettes
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-pencil"></span>
     
    Documentation
  </a>
</li>
<li>
  <a href="https://github.com/acabassi/vimix">
    <span class="fa fa-github fa-lg"></span>
     
    GitHub
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Variable selection</h1>
                        <h4 class="author">Alessandra Cabassi</h4>
            
            <h4 class="date">2019-04-01</h4>
      
      
      <div class="hidden name"><code>variable-selection.Rmd</code></div>

    </div>

    
    
<p>Suppose we have a small dataset containing three clusters.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co">## Generate a dataset containing 300 2-dimensional data points</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">data &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">rbind</a></span>(<span class="kw">rmvnorm</span>(<span class="dv">100</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>,<span class="op">-</span><span class="dv">5</span>)), <span class="kw">rmvnorm</span>(<span class="dv">100</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>,<span class="dv">0</span>)), <span class="kw">rmvnorm</span>(<span class="dv">100</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>,<span class="dv">5</span>)), <span class="kw">rmvnorm</span>(<span class="dv">100</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">10</span>)))</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">D =<span class="st"> </span><span class="dv">2</span>; N =<span class="st"> </span><span class="dv">300</span>; K =<span class="st"> </span><span class="dv">4</span></a></code></pre></div>
<p>If we assume that all the covariates are independent, one can also choose to do variable selection and only retain the variables that help define the clustering.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="co">## Use variational inference for mixture of Gaussians to find clusters</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">output &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vimix.html">vimix</a></span>(data, <span class="dt">K =</span> <span class="dv">4</span>, <span class="dt">select =</span> <span class="ot">TRUE</span>, <span class="dt">verbose =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>This is how the hyperparameters change at each iteration:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">niter=<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(output<span class="op">$</span>L)<span class="op">-</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"></a>
<a class="sourceLine" id="cb3-3" data-line-number="3">parameters &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">alpha =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1</span><span class="op">/</span>K, K), <span class="dt">Nk =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(N<span class="op">/</span>K, K),</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">                     <span class="dt">beta1 =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">20</span>, K), <span class="dt">beta2 =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">20</span>, K),</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">                     <span class="dt">mean1 =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(data)[<span class="dv">1</span>], K), <span class="dt">mean2 =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(data)[<span class="dv">2</span>], K),</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">                     <span class="dt">v1 =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">50</span><span class="op">+</span>D, K), <span class="dt">v2 =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">50</span><span class="op">+</span>D, K),</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">                     <span class="dt">W1 =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1</span>, K), <span class="dt">W2 =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">2</span>,K),</a>
<a class="sourceLine" id="cb3-8" data-line-number="8">                     <span class="dt">cluster =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">as.factor</a></span>(<span class="dv">1</span><span class="op">:</span>K), <span class="dt">iteration =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">0</span>,K))</a>
<a class="sourceLine" id="cb3-9" data-line-number="9"></a>
<a class="sourceLine" id="cb3-10" data-line-number="10">more_parameters &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">c1 =</span> <span class="fl">.5</span>, <span class="dt">c2 =</span> <span class="fl">.5</span>, <span class="dt">iteration =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb3-11" data-line-number="11"></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>niter){</a>
<a class="sourceLine" id="cb3-13" data-line-number="13">    oi &lt;-<span class="st"> </span>output<span class="op">$</span>model_list[[i]]</a>
<a class="sourceLine" id="cb3-14" data-line-number="14">    parameters &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(parameters, <span class="kw">tibble</span>(<span class="dt">alpha =</span> oi<span class="op">$</span>alpha, <span class="dt">Nk =</span> oi<span class="op">$</span>Nk,</a>
<a class="sourceLine" id="cb3-15" data-line-number="15">                                           <span class="dt">beta1 =</span> oi<span class="op">$</span>beta[<span class="dv">1</span>,], <span class="dt">beta2 =</span> oi<span class="op">$</span>beta[<span class="dv">2</span>,],</a>
<a class="sourceLine" id="cb3-16" data-line-number="16">                                           <span class="dt">mean1 =</span> oi<span class="op">$</span>m[<span class="dv">1</span>,], <span class="dt">mean2 =</span> oi<span class="op">$</span>m[<span class="dv">2</span>,],</a>
<a class="sourceLine" id="cb3-17" data-line-number="17">                                           <span class="dt">v1 =</span> oi<span class="op">$</span>v[<span class="dv">1</span>,], <span class="dt">v2 =</span> oi<span class="op">$</span>v[<span class="dv">2</span>,],</a>
<a class="sourceLine" id="cb3-18" data-line-number="18">                                           <span class="dt">W1 =</span> oi<span class="op">$</span>W[<span class="dv">1</span>,], <span class="dt">W2 =</span> oi<span class="op">$</span>W[<span class="dv">2</span>,],</a>
<a class="sourceLine" id="cb3-19" data-line-number="19">                                           <span class="dt">cluster =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">as.factor</a></span>(<span class="dv">1</span><span class="op">:</span>K), <span class="dt">iteration =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(i,K)))</a>
<a class="sourceLine" id="cb3-20" data-line-number="20">    more_parameters &lt;-<span class="st"> </span><span class="kw">add_row</span>(more_parameters, <span class="dt">c1 =</span> oi<span class="op">$</span>c[<span class="dv">1</span>], <span class="dt">c2 =</span> oi<span class="op">$</span>c[<span class="dv">2</span>], <span class="dt">iteration =</span> i)</a>
<a class="sourceLine" id="cb3-21" data-line-number="21">}</a>
<a class="sourceLine" id="cb3-22" data-line-number="22"></a>
<a class="sourceLine" id="cb3-23" data-line-number="23">plotA &lt;-<span class="st"> </span><span class="kw">ggplot</span>(parameters, <span class="kw">aes</span>(<span class="dt">x =</span> iteration, <span class="dt">y =</span> alpha, <span class="dt">color =</span> cluster)) <span class="op">+</span><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">"none"</span>)</a>
<a class="sourceLine" id="cb3-24" data-line-number="24">plotN &lt;-<span class="st"> </span><span class="kw">ggplot</span>(parameters, <span class="kw">aes</span>(<span class="dt">x =</span> iteration, <span class="dt">y =</span> Nk, <span class="dt">color =</span> cluster)) <span class="op">+</span><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">"none"</span>)</a>
<a class="sourceLine" id="cb3-25" data-line-number="25">plotB1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(parameters, <span class="kw">aes</span>(<span class="dt">x =</span> iteration, <span class="dt">y =</span> beta1, <span class="dt">color =</span> cluster)) <span class="op">+</span><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">"none"</span>)</a>
<a class="sourceLine" id="cb3-26" data-line-number="26">plotB2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(parameters, <span class="kw">aes</span>(<span class="dt">x =</span> iteration, <span class="dt">y =</span> beta2, <span class="dt">color =</span> cluster)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">"none"</span>)</a>
<a class="sourceLine" id="cb3-27" data-line-number="27"><span class="kw">grid.arrange</span>(plotA, plotN, plotB1, plotB2, <span class="dt">ncol =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb3-28" data-line-number="28"></a>
<a class="sourceLine" id="cb3-29" data-line-number="29">plotM1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(parameters, <span class="kw">aes</span>(<span class="dt">x =</span> iteration, <span class="dt">y =</span> mean1, <span class="dt">color =</span> cluster)) <span class="op">+</span><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">"none"</span>)</a>
<a class="sourceLine" id="cb3-30" data-line-number="30">plotM2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(parameters, <span class="kw">aes</span>(<span class="dt">x =</span> iteration, <span class="dt">y =</span> mean2, <span class="dt">color =</span> cluster)) <span class="op">+</span><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">"none"</span>)</a>
<a class="sourceLine" id="cb3-31" data-line-number="31">plotv1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(parameters, <span class="kw">aes</span>(<span class="dt">x =</span> iteration, <span class="dt">y =</span> v1, <span class="dt">color =</span> cluster)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">"none"</span>)</a>
<a class="sourceLine" id="cb3-32" data-line-number="32">plotv2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(parameters, <span class="kw">aes</span>(<span class="dt">x =</span> iteration, <span class="dt">y =</span> v2, <span class="dt">color =</span> cluster)) <span class="op">+</span><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">"none"</span>)</a>
<a class="sourceLine" id="cb3-33" data-line-number="33"><span class="kw">grid.arrange</span>(plotM1, plotM2,  plotv1, plotv2, <span class="dt">ncol =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb3-34" data-line-number="34"></a>
<a class="sourceLine" id="cb3-35" data-line-number="35">plotW1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(parameters, <span class="kw">aes</span>(<span class="dt">x =</span> iteration, <span class="dt">y =</span> W1, <span class="dt">color =</span> cluster)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">"none"</span>)</a>
<a class="sourceLine" id="cb3-36" data-line-number="36">plotW2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(parameters, <span class="kw">aes</span>(<span class="dt">x =</span> iteration, <span class="dt">y =</span> W2, <span class="dt">color =</span> cluster)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">"none"</span>)</a>
<a class="sourceLine" id="cb3-37" data-line-number="37">plotC1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(more_parameters, <span class="kw">aes</span>(<span class="dt">x =</span> iteration, <span class="dt">y =</span> c1)) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot.window">ylim</a></span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">"none"</span>)</a>
<a class="sourceLine" id="cb3-38" data-line-number="38">plotC2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(more_parameters, <span class="kw">aes</span>(<span class="dt">x =</span> iteration, <span class="dt">y =</span> c2)) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot.window">ylim</a></span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">"none"</span>)</a>
<a class="sourceLine" id="cb3-39" data-line-number="39"><span class="kw">grid.arrange</span>(plotW1, plotW2, plotC1, plotC2, <span class="dt">ncol =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="variable-selection_files/figure-html/debug-1.png" width="700"><img src="variable-selection_files/figure-html/debug-2.png" width="700"><img src="variable-selection_files/figure-html/debug-3.png" width="700"> and these are the posterior densities:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(DirichletReg)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co">## First variable</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"></a>
<a class="sourceLine" id="cb4-5" data-line-number="5">pi &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/DirichletReg/topics/Dirichlet">rdirichlet</a></span>(<span class="dv">200</span>, output<span class="op">$</span>model<span class="op">$</span>alpha)</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">cluster &lt;-<span class="st"> </span>lambda &lt;-<span class="st"> </span>mean &lt;-<span class="st"> </span>obs &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="dv">200</span>, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">200</span>){</a>
<a class="sourceLine" id="cb4-8" data-line-number="8">    cluster[i] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/which">which</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Multinom">rmultinom</a></span>(<span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> pi[i,])<span class="op">!=</span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb4-9" data-line-number="9">    lambda[i] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/GammaDist">rgamma</a></span>(<span class="dv">1</span>, <span class="dt">shape =</span> output<span class="op">$</span>model<span class="op">$</span>v[<span class="dv">1</span>,cluster[i]], <span class="dt">rate =</span> <span class="dv">1</span><span class="op">/</span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>output<span class="op">$</span>model<span class="op">$</span>W[<span class="dv">1</span>,cluster[i]]))</a>
<a class="sourceLine" id="cb4-10" data-line-number="10">    mean[i] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="dv">1</span>, output<span class="op">$</span>model<span class="op">$</span>m[<span class="dv">1</span>,cluster[i]], <span class="dv">1</span><span class="op">/</span>(output<span class="op">$</span>model<span class="op">$</span>beta[<span class="dv">1</span>,cluster[i]]<span class="op">*</span>lambda[i]))</a>
<a class="sourceLine" id="cb4-11" data-line-number="11">    obs[i] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="dv">1</span>, mean[i], <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/MathFun">sqrt</a></span>(lambda[i]))</a>
<a class="sourceLine" id="cb4-12" data-line-number="12">}</a>
<a class="sourceLine" id="cb4-13" data-line-number="13">samples &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="dv">200</span>, <span class="dt">mean =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(data[,<span class="dv">1</span>]), <span class="dt">sd =</span> stats<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/sd">sd</a></span>(data[,<span class="dv">1</span>])), obs)</a>
<a class="sourceLine" id="cb4-14" data-line-number="14"></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(broom)</a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb4-17" data-line-number="17">samples &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/broom/topics/reexports">tidy</a></span>(samples)</a>
<a class="sourceLine" id="cb4-18" data-line-number="18">samples<span class="op">$</span>cluster &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">as.factor</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">'null'</span>,<span class="dv">200</span>), cluster))</a>
<a class="sourceLine" id="cb4-19" data-line-number="19"></a>
<a class="sourceLine" id="cb4-20" data-line-number="20">plotX1 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(samples, <span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> x, <span class="dt">fill =</span> cluster, <span class="dt">color =</span> cluster)) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-21" data-line-number="21"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/geom_density">geom_density</a></span>(<span class="dt">alpha =</span> <span class="fl">0.1</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/lims">xlim</a></span>(<span class="op">-</span><span class="dv">10</span>,<span class="dv">10</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/theme">theme</a></span>(<span class="dt">legend.position=</span><span class="st">"bottom"</span>)</a>
<a class="sourceLine" id="cb4-22" data-line-number="22"></a>
<a class="sourceLine" id="cb4-23" data-line-number="23"><span class="co">## Second variable</span></a>
<a class="sourceLine" id="cb4-24" data-line-number="24"></a>
<a class="sourceLine" id="cb4-25" data-line-number="25">pi &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/DirichletReg/topics/Dirichlet">rdirichlet</a></span>(<span class="dv">200</span>, output<span class="op">$</span>model<span class="op">$</span>alpha)</a>
<a class="sourceLine" id="cb4-26" data-line-number="26">cluster &lt;-<span class="st"> </span>lambda &lt;-<span class="st"> </span>mean &lt;-<span class="st"> </span>obs &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="dv">200</span>, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb4-27" data-line-number="27"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">200</span>){</a>
<a class="sourceLine" id="cb4-28" data-line-number="28">    cluster[i] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/which">which</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Multinom">rmultinom</a></span>(<span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> pi[i,])<span class="op">!=</span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb4-29" data-line-number="29">    lambda[i] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/GammaDist">rgamma</a></span>(<span class="dv">1</span>, <span class="dt">shape =</span> output<span class="op">$</span>model<span class="op">$</span>v[<span class="dv">2</span>,cluster[i]], <span class="dt">rate =</span> <span class="dv">1</span><span class="op">/</span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>output<span class="op">$</span>model<span class="op">$</span>W[<span class="dv">2</span>,cluster[i]]))</a>
<a class="sourceLine" id="cb4-30" data-line-number="30">    mean[i] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="dv">1</span>, output<span class="op">$</span>model<span class="op">$</span>m[<span class="dv">2</span>,cluster[i]], <span class="dv">1</span><span class="op">/</span>(output<span class="op">$</span>model<span class="op">$</span>beta[<span class="dv">2</span>,cluster[i]]<span class="op">*</span>lambda[i]))</a>
<a class="sourceLine" id="cb4-31" data-line-number="31">    obs[i] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="dv">1</span>, mean[i], <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/MathFun">sqrt</a></span>(lambda[i]))</a>
<a class="sourceLine" id="cb4-32" data-line-number="32">}</a>
<a class="sourceLine" id="cb4-33" data-line-number="33">samples &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="dv">200</span>, <span class="dt">mean =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(data[,<span class="dv">2</span>]), <span class="dt">sd =</span> stats<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/sd">sd</a></span>(data[,<span class="dv">2</span>])), obs)</a>
<a class="sourceLine" id="cb4-34" data-line-number="34">samples &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/broom/topics/reexports">tidy</a></span>(samples)</a>
<a class="sourceLine" id="cb4-35" data-line-number="35">samples<span class="op">$</span>cluster &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">as.factor</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">'null'</span>,<span class="dv">200</span>), cluster))</a>
<a class="sourceLine" id="cb4-36" data-line-number="36"></a>
<a class="sourceLine" id="cb4-37" data-line-number="37">plotX2 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(samples, <span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> x, <span class="dt">fill =</span> cluster, <span class="dt">color =</span> cluster)) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-38" data-line-number="38"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/geom_density">geom_density</a></span>(<span class="dt">alpha =</span> <span class="fl">0.1</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/lims">xlim</a></span>(<span class="op">-</span><span class="dv">10</span>,<span class="dv">10</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/theme">theme</a></span>(<span class="dt">legend.position=</span><span class="st">"bottom"</span>)</a>
<a class="sourceLine" id="cb4-39" data-line-number="39"></a>
<a class="sourceLine" id="cb4-40" data-line-number="40"><span class="kw">grid.arrange</span>(plotX1, plotX2, <span class="dt">ncol =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="variable-selection_files/figure-html/example1-vs-param-1.png" width="700"></p>
<p>Now let’s see what our clusters look like:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co">## Plot cluster labels</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(broom)</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(gridExtra)</a>
<a class="sourceLine" id="cb5-5" data-line-number="5"></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co">## Convert data matrix and cluster labels to data.frame</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7">df &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/broom/topics/reexports">tidy</a></span>(data)</a>
<a class="sourceLine" id="cb5-8" data-line-number="8">df<span class="op">$</span>label &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">as.factor</a></span>(output<span class="op">$</span>label)</a>
<a class="sourceLine" id="cb5-9" data-line-number="9">df &lt;-<span class="st"> </span><span class="kw">add_row</span>(df, <span class="dt">X1 =</span> output<span class="op">$</span>model<span class="op">$</span>m[<span class="dv">1</span>,], <span class="dt">X2 =</span> output<span class="op">$</span>model<span class="op">$</span>m[<span class="dv">2</span>,], <span class="dt">label =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">as.factor</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"Centres"</span>,K)))</a>
<a class="sourceLine" id="cb5-10" data-line-number="10"></a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="co">## Plot clusters</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(df, <span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(X1, X2, <span class="dt">col =</span> label)) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>()</a></code></pre></div>
<p><img src="variable-selection_files/figure-html/example1-vs-plot-1.png" width="700"></p>
<p>The cluster labels are calculated by taking the maximum responsibility for each data point. In this case, the responsibilities in each cluster look like this:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/broom/topics/reexports">tidy</a></span>(data)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">df<span class="op">$</span>resp1 &lt;-<span class="st"> </span>output<span class="op">$</span>model<span class="op">$</span>Resp[,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">df<span class="op">$</span>resp2 &lt;-<span class="st"> </span>output<span class="op">$</span>model<span class="op">$</span>Resp[,<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">df<span class="op">$</span>resp3 &lt;-<span class="st"> </span>output<span class="op">$</span>model<span class="op">$</span>Resp[,<span class="dv">3</span>]</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">df<span class="op">$</span>resp4 &lt;-<span class="st"> </span>output<span class="op">$</span>model<span class="op">$</span>Resp[,<span class="dv">4</span>]</a>
<a class="sourceLine" id="cb6-6" data-line-number="6"></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co">## Plot clusters</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8">plotR1 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(df, <span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(X1, X2, <span class="dt">col =</span> resp1)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>() <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/scale_size">scale_size_continuous</a></span>(<span class="dt">breaks=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dt">by=</span><span class="fl">0.25</span>))</a>
<a class="sourceLine" id="cb6-10" data-line-number="10">plotR2 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(df, <span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(X1, X2, <span class="dt">col =</span> resp2)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>() <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/scale_size">scale_size_continuous</a></span>(<span class="dt">breaks=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dt">by=</span><span class="fl">0.25</span>))</a>
<a class="sourceLine" id="cb6-12" data-line-number="12">plotR3 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(df, <span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(X1, X2, <span class="dt">col =</span> resp3)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>() <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/scale_size">scale_size_continuous</a></span>(<span class="dt">breaks=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dt">by=</span><span class="fl">0.25</span>))</a>
<a class="sourceLine" id="cb6-14" data-line-number="14">plotR4 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(df, <span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(X1, X2, <span class="dt">col =</span> resp4)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-15" data-line-number="15"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>() <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/scale_size">scale_size_continuous</a></span>(<span class="dt">breaks=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dt">by=</span><span class="fl">0.25</span>))</a>
<a class="sourceLine" id="cb6-16" data-line-number="16"></a>
<a class="sourceLine" id="cb6-17" data-line-number="17"><span class="kw"><a href="https://www.rdocumentation.org/packages/gridExtra/topics/arrangeGrob">grid.arrange</a></span>(plotR1, plotR2, plotR3, plotR4, <span class="dt">ncol =</span> <span class="dv">4</span>)</a></code></pre></div>
<p><img src="variable-selection_files/figure-html/resp1-1.png" width="700"></p>
<p>The lower bound increases at each iteration of the algorithm and can be used to check whether the algorithm has converged. Another interesting value to check at each iteration is the number of non-empty clusters.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co">## Check that the lower bound is monotonically increasing</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"></a>
<a class="sourceLine" id="cb7-3" data-line-number="3">lb &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/broom/topics/reexports">tidy</a></span>(output<span class="op">$</span>L[<span class="op">-</span><span class="dv">1</span>])</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">lb<span class="op">$</span>ELBO &lt;-<span class="st"> </span>lb<span class="op">$</span>x</a>
<a class="sourceLine" id="cb7-5" data-line-number="5">lb<span class="op">$</span>x &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6">lb<span class="op">$</span>iter &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(output<span class="op">$</span>L[<span class="op">-</span><span class="dv">1</span>]))</a>
<a class="sourceLine" id="cb7-7" data-line-number="7">lb<span class="op">$</span>number_clusters &lt;-<span class="st"> </span>output<span class="op">$</span>Cl[<span class="op">-</span><span class="dv">1</span>]</a>
<a class="sourceLine" id="cb7-8" data-line-number="8"></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">## Plot lower bound</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10">plot_lb &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(lb, <span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>iter,<span class="dt">y=</span>ELBO)) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>(<span class="dt">linetype =</span> <span class="st">"dashed"</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>()</a>
<a class="sourceLine" id="cb7-11" data-line-number="11"></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="co">## Plot number of non-empty clusters</span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13">plot_nc &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(lb, <span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>iter,<span class="dt">y=</span>number_clusters)) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>(<span class="dt">linetype =</span> <span class="st">"dashed"</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>()</a>
<a class="sourceLine" id="cb7-14" data-line-number="14"></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="kw"><a href="https://www.rdocumentation.org/packages/gridExtra/topics/arrangeGrob">grid.arrange</a></span>(plot_lb, plot_nc, <span class="dt">ncol =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="variable-selection_files/figure-html/example1-vs-lb-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">maxK &lt;-<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">n_random_starts &lt;-<span class="st"> </span><span class="dv">15</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3">ELBO &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="dv">0</span>, maxK<span class="dv">-1</span>, n_random_starts)</a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span>maxK){</a>
<a class="sourceLine" id="cb8-5" data-line-number="5">    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n_random_starts){</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">        output &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vimix.html">vimix</a></span>(data, <span class="dt">K =</span> k, <span class="dt">select =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb8-7" data-line-number="7">        ELBO[k<span class="dv">-1</span>,j] &lt;-<span class="st"> </span>output<span class="op">$</span>L[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(output<span class="op">$</span>L)]</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">    }</a>
<a class="sourceLine" id="cb8-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb8-10" data-line-number="10"></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(reshape)</a>
<a class="sourceLine" id="cb8-12" data-line-number="12">ELBO &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/reshape/topics/melt-24">melt</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(ELBO))</a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(ELBO) &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'start_n'</span>, <span class="st">'K'</span>, <span class="st">'ELBO'</span>)</a>
<a class="sourceLine" id="cb8-14" data-line-number="14">ELBO<span class="op">$</span>K &lt;-<span class="st"> </span>ELBO<span class="op">$</span>K <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"></a>
<a class="sourceLine" id="cb8-16" data-line-number="16"><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(ELBO, <span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> K, <span class="dt">y =</span> ELBO)) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>() <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/geom_jitter">geom_jitter</a></span>()</a></code></pre></div>
<p><img src="variable-selection_files/figure-html/example1-vs-figure10-7-1.png" width="700"></p>
<p>Let’s compare this to what we would have found without variable selection</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="co">## Use variational inference for mixture of Gaussians to find clusters</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3">output &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vimix.html">vimix</a></span>(data, <span class="dt">K =</span> <span class="dv">4</span>, <span class="dt">select =</span> <span class="ot">FALSE</span>,  <span class="dt">indep =</span> <span class="ot">TRUE</span>, <span class="dt">verbose =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="co">## Plot cluster labels</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(broom)</a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(gridExtra)</a>
<a class="sourceLine" id="cb10-5" data-line-number="5"></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co">## Convert data matrix and cluster labels to data.frame</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7">df &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/broom/topics/reexports">tidy</a></span>(data)</a>
<a class="sourceLine" id="cb10-8" data-line-number="8">df<span class="op">$</span>label &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">as.factor</a></span>(output<span class="op">$</span>label)</a>
<a class="sourceLine" id="cb10-9" data-line-number="9">df &lt;-<span class="st"> </span><span class="kw">add_row</span>(df, <span class="dt">X1 =</span> output<span class="op">$</span>model<span class="op">$</span>m[<span class="dv">1</span>,], <span class="dt">X2 =</span> output<span class="op">$</span>model<span class="op">$</span>m[<span class="dv">2</span>,], <span class="dt">label =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">as.factor</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"Centres"</span>,K)))</a>
<a class="sourceLine" id="cb10-10" data-line-number="10"></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co">## Plot clusters</span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(df, <span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(X1, X2, <span class="dt">col =</span> label)) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>()</a></code></pre></div>
<p><img src="variable-selection_files/figure-html/same-ind-plot-1.png" width="700"></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co">## Check that the lower bound is monotonically increasing</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"></a>
<a class="sourceLine" id="cb11-3" data-line-number="3">lb &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/broom/topics/reexports">tidy</a></span>(output<span class="op">$</span>L[<span class="op">-</span><span class="dv">1</span>])</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">lb<span class="op">$</span>ELBO &lt;-<span class="st"> </span>lb<span class="op">$</span>x</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">lb<span class="op">$</span>x &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6">lb<span class="op">$</span>iter &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(output<span class="op">$</span>L[<span class="op">-</span><span class="dv">1</span>]))</a>
<a class="sourceLine" id="cb11-7" data-line-number="7">lb<span class="op">$</span>number_clusters &lt;-<span class="st"> </span>output<span class="op">$</span>Cl[<span class="op">-</span><span class="dv">1</span>]</a>
<a class="sourceLine" id="cb11-8" data-line-number="8"></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="co">## Plot lower bound</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10">plot_lb &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(lb, <span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>iter,<span class="dt">y=</span>ELBO)) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>(<span class="dt">linetype =</span> <span class="st">"dashed"</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>()</a>
<a class="sourceLine" id="cb11-11" data-line-number="11"></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="co">## Plot number of non-empty clusters</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13">plot_nc &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(lb, <span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>iter,<span class="dt">y=</span>number_clusters)) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>(<span class="dt">linetype =</span> <span class="st">"dashed"</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>()</a>
<a class="sourceLine" id="cb11-14" data-line-number="14"></a>
<a class="sourceLine" id="cb11-15" data-line-number="15"><span class="kw"><a href="https://www.rdocumentation.org/packages/gridExtra/topics/arrangeGrob">grid.arrange</a></span>(plot_lb, plot_nc, <span class="dt">ncol =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="variable-selection_files/figure-html/same-ind-lb-1.png" width="700"></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">maxK &lt;-<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2">n_random_starts &lt;-<span class="st"> </span><span class="dv">15</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3">ELBO &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="dv">0</span>, maxK<span class="dv">-1</span>, n_random_starts)</a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span>maxK){</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n_random_starts){</a>
<a class="sourceLine" id="cb12-6" data-line-number="6">        output &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vimix.html">vimix</a></span>(data, <span class="dt">K =</span> k, <span class="dt">select =</span> <span class="ot">FALSE</span>, <span class="dt">indep =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb12-7" data-line-number="7">        ELBO[k<span class="dv">-1</span>,j] &lt;-<span class="st"> </span>output<span class="op">$</span>L[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(output<span class="op">$</span>L)]</a>
<a class="sourceLine" id="cb12-8" data-line-number="8">    }</a>
<a class="sourceLine" id="cb12-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb12-10" data-line-number="10"></a>
<a class="sourceLine" id="cb12-11" data-line-number="11"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(reshape)</a>
<a class="sourceLine" id="cb12-12" data-line-number="12">ELBO &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/reshape/topics/melt-24">melt</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(ELBO))</a>
<a class="sourceLine" id="cb12-13" data-line-number="13"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(ELBO) &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'start_n'</span>, <span class="st">'K'</span>, <span class="st">'ELBO'</span>)</a>
<a class="sourceLine" id="cb12-14" data-line-number="14">ELBO<span class="op">$</span>K &lt;-<span class="st"> </span>ELBO<span class="op">$</span>K <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb12-15" data-line-number="15"></a>
<a class="sourceLine" id="cb12-16" data-line-number="16"><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(ELBO, <span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> K, <span class="dt">y =</span> ELBO)) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>() <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/geom_jitter">geom_jitter</a></span>()</a></code></pre></div>
<p><img src="variable-selection_files/figure-html/same-ind-figure10-7-1.png" width="700"></p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://alessandracabassi.wordpress.com">Alessandra Cabassi</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
